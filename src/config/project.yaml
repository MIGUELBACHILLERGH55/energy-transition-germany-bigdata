project:
  name: energiewende_big_data
  timezone: UTC 

# ======================================================================
# Environment and storage configuration 
# ----------------------------------------------------------------------
# Each "environment" (local or prod) maps logical layers 
# (bronze/silver/gold) to physical storage profiles.
# ======================================================================

# Which environment profile to activate (maps logical layer -> physical properties)
active_env: local


# ----------------------------------------------------------------------
# Physical profiles (actual storage backends)
# ----------------------------------------------------------------------
# These define *where* data will be physically stored.
# - "local_fs" saves data to the local file system.
# - "s3_prod" saves data to an s3 bucket.
# ----------------------------------------------------------------------

profiles:
  local_fs:
    type: file
    base_path: "data" # local folder root
  s3_prod:
    type: s3
    bucket: "energiewende-prod"
    base_path: "" # optional prefix inside the bucker


# ----------------------------------------------------------------------
# Map environments -> which profile each layer uses
# ----------------------------------------------------------------------
# In the "local" environment, all layers use the local file system.
# In the "prod" environment, all layers write to the s3 bucket.
# ----------------------------------------------------------------------

env_profiles:
  local:
    bronze: local_fs
    silver: local_fs
    gold: local_fs
  prod:
    bronze: s3_prod
    silver: s3_prod
    gold: s3_prod

# ----------------------------------------------------------------------
# Default layer definitions (used unless overridden per dataset)
# ----------------------------------------------------------------------
# Each logical layer has a default storage location and file format.
# - Bronze: raw or ingest data (JSON, CSV, etc.)
# - Silver: cleaned/structured data (Parquet)
# - Gold: aggregated or business-ready data (Parque, partitioned)
# ----------------------------------------------------------------------

defaults:
  bronze: 
    profile_ref: bronze
    path: "bronze/"
    format: json # format in origin 
  silver:
    profile_ref: silver
    path: "silver/"
    format: parquet 
  gold:
    profile_ref: gold
    path: "gold/"
    format: parquet 

# ======================================================================
# DATA SOURCES
# ----------------------------------------------------------------------
# Each "source" defines a data provider (API, file, DB, etc.)
# Each "dataset" under a source defines:
# - How to access it (API params, file path, etc.)
# - How to store it (file naming, destination paths, formats)
# ======================================================================
sources:

  # ------------------------------------------------------------
  # SMARD (Bundesnetzagentur)
  # ------------------------------------------------------------
  # Provides electricity market data such as:
  # - Day-ahead prices
  # - Generation by technology
  # - Consumption, etc.
  #
  # Used for: near real-time market analysis and energy transition monitoring
  # ============================================================
  smard:
    enabled: true                     # If false, the entire source is ignored

    # --- Default settings for this source (can be overridden per dataset) ---
    kind: api                        # Access type (api|file|ftp|db). 
    base_url: "https://www.smard.de/app/chart_data"  # Base endpoint for SMARD API calls
    headers:
      user_agent: "energiewende-ingestor/1.0"        # HTTP header to identify this client
    retry: 3                         # Default number of retries per request
    timeout_s: 60                    # Default timeout per request in seconds

    datasets:
      # --- Market price (Day-Ahead) ---
      prices:                        # Logical dataset name
        access: api                  # Access type (api)
        request:                     # API request parameters specific to this dataset
          filter: 4169               # SMARD dataset ID (Day-Ahead Market Price)
          region: "DE"               # Germany
          resolution: "hour"         # Temporal resolution (hourly)
          # endpoint: ""             # Optional: override endpoint relative to base_url
        storage:                     
          # The bronze (raw) Layer typically keeps data as-is
          # so we define a date-based filename for each ingestion batch.
          file_naming: "smard_prices_{yyyy}-{mm}-{dd}.csv" # TODO: explore output format.
        metadata:                    # Internal metadata and scheduling rules
          dataset_id: "smard.prices.hourly"        # Unique internal ID for tracking
          source_resolution: "hour"  # Frequency from source
          granularity: hourly        # Processing frequency (matching or derived)
          tz: "Europe/Berlin"        # Original timezone of the data
          schedule: daily            # How often we expect new data
          format: csv                # File format to expect/save
        enabled: true                # Can disable a single dataset without deleting its config
        # retry: 5                   # Optional: override retry only for this dataset
        # timeout_s: 120             # Optional: override timeout only for this dataset

        # ----------------------------------------------------------------------
        # Destination overrides per layer
        # ----------------------------------------------------------------------
        # Here we explicitly define where each layer should store its data.
        # The actual full path is resolved as:
        #   [profile.base_path] + [destination.path]
        #
        # Example (in local env):
        #   profile.base_path = "data/"
        #   destination.path = "bronze/smard/prices"
        #   -> data/bronze/smard/prices
        # ----------------------------------------------------------------------

        destinations:
          bronze:
            path: "bronze/smard/prices/"
            # Format is inherited from defaults.bronze (json)
          silver:
            path: "silver/smard/prices/"
            # format: parquet Used to override the defaults.silver.foramt if necessary
          gold:
            path: "silver/smard/prices_daily/"
            format: parquet
            partitioning: ["yyyy", "mm", "dd"] 
            # ------------------------------------------------------------
            # "partitioning" defines how data files are physically organized
            # inside the storage layer (e.g., S3, local folder).
            # It doesn't change the data itself — only the directory structure.
            #
            # For example, with this setting and a record dated 2025-11-08:
            #
            #   gold/smard/prices_daily/
            #     └── yyyy=2025/
            #         └── mm=11/
            #             └── dd=08/
            #                 └── part-0000.parquet
            #
            # This helps big-data engines (Spark, DuckDB, etc.) perform
            # efficient queries — e.g. reading only one month or one day
            # without scanning the entire dataset.
            # ------------------------------------------------------------
            
      # --- Electricity generation by technology: Solar ---
      generation_solar:
        enabled: true
        access: api
        request:
          filter: 4068
          region: "DE"
          resolution: "hour"
        storage:
          file_naming: "smard_generation_solar_{yyyy}-{mm}-{dd}.csv"
        metadata:
          dataset_id: "smard.generation.solar.hourly"
          source_resolution: "hour"
          granularity: hourly
          tz: "Europe/Berlin"
          schedule: daily
          format: csv
          destinations:
            landing:
              path: "landing/smard/generation/"
            silver:
              path: "silver/smard/generation_solar/"
              format: parquet



    # ============================================================
    # OPSD (Open Power System Data)
    # ------------------------------------------------------------
    # Clean historical series (2010–present)
    # Provides: generation, demand, installed capacity, emissions
    # Used for: long term analysis and SMARD validation
    # ============================================================
    opsd:
      enabled: false
      base_url: ""                      # (yet to complete)
      datasets: {}
      # TODO: identify which datasets to use (generation, demand).

    # ============================================================
    # DWD (Deutscher Wetterdienst)
    # ------------------------------------------------------------
    # German meteorologica service 
    # Provides: wind, solar radiation, temperature, precipitation
    # Used for: correlation between climate and renewable generation / demand 
    # ============================================================
    dwd:
      enabled: false
      base_url: ""                      # (yet to complete)
      datasets: {}
      # TODO: search endpoints or routes FTP paths from daily/monthly observations.

    # ============================================================
    # AG Energiebilanzen (AGEB)
    # ------------------------------------------------------------
    # German Energy Balance Association
    # Provides: Energy mix structure and balances (1990–2010)
    # Used for: Historical period before OPSD
    # ============================================================
    ag_energiebilanzen:
      enabled: false
      base_url: ""                      # (yet to complete)
      datasets: {}
      # TODO: locate files official CSV/PDF of AGEB (anual balance sheet).

    # ============================================================
    # Destatis (Statistisches Bundesamt)
    # ------------------------------------------------------------
    # Federal Office of Statistics
    # Provides: CO2 emissions and national energy consumption
    # Used for: macro validation and consistency with enerergy series
    # ============================================================
    destatis:
      enabled: false
      base_url: ""                      # (yet to complete)
      datasets: {}
      # TODO: identify the relevant table codes GENESIS-Online).

    # ============================================================
    # IEA (International Energy Agency)
    # ------------------------------------------------------------
    # International Energy Agence
    # Provides: energy and emissions data by country
    # Used for: international comparison and benchmarking
    # ============================================================
    iea:
      enabled: false
      base_url: ""                      # (yet to complete)
      datasets: {}
    # TODO: Review IEA's official API and licenses for educational use

    # ============================================================
    # Eurostat (European Commission)
    # ------------------------------------------------------------
    # Statistical Office of the European Union
    # Provides: balances, prices, renewable energy share, emissions
    # Used for: comparison with other European countries
    # ============================================================
    eurostat:
      enabled: false
      base_url: ""                      # (yet to complete)
      datasets: {}
      # TODO: Examine the Eurostat API (SDMX) for energy datasets


